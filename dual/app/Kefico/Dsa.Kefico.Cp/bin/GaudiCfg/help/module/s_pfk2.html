<HTML>
<HEAD>
<TITLE>S_PFK2</TITLE>
<META NAME="Generator" CONTENT="KDOC ">
</HEAD>
<BODY bgcolor="#ffffff" text="#000000" link="#0000ff" vlink="#000099" alink= "#ffffff">

<table BORDER=0 COLS=1 WIDTH="100%" BGCOLOR="#FFFFCC" NOSAVE >
<tr ALIGN=CENTER VALIGN=CENTER NOSAVE>
<td NOSAVE><font face="Arial,Helvetica"><font size=+2></font></font>
<br><font face="Arial,Helvetica"><font size=+2>CCS Modul &nbsp;&nbsp;<b>S_PFK2</b></font></font>
<br>&nbsp;</td>
</tr>
</table>
<PRE>
   $Id: s_pfk2.C,v 1.12 2005/12/02 15:08:41 krf3rt Exp $
   ---------------------------------------------------------------------
   Kurzbeschreibung: 	Routine zur Ermittlung der Prueffortschrittskennung
   ---------------------------------------------------------------------
   Projekt:		CCS 
   Sourcefile:		s_pfk2.C 
   Autor:		RtW2/TEF72-Keppler (17.03.2003)
   Zielsystem:		HP9000/V743 (HP-RT 3.01), /7/C/D (HP-UX 10.20),Linux
   Sprache:		C++
   ---------------------------------------------------------------------
   Prototype:
   MPI Schnittstelle
   void s_pfk2(shm_stringpointer *zeilen_info
	   ,shm_stringpointer    *zeilen_wert
	   ,long index1
	   ,long anzahl)
   
   ---------------------------------------------------------------------
   Aufruf: im Vectorinterpreter
   
	 (*funktionen[modulnummer])
	    (Ssp_expand_zeile
	     ,Ssp_expand_wert
	     ,p_verwaltung-&gt;begin_modulblock
	     ,p_verwaltung-&gt;anzahl_modulparameter); 
   
   
 
   ---------------------------------------------------------------------
   ---------------------------------------------------------------------
   Funktionsbeschreibung:
   
   Dieses Modul dient zur Erzeugung der Daten für die Prüfvortschrittskennung.
   Siehe hierzu auch im Modul s_pfk. 
   Dieses Modul arbeitet wie s_pfk, jedoch kann im Konfigfile pfk_konvert2.cnf
   Produktabhängig die Beziehung zwischen dem Prueftyp und dem Standtyp definiert
   werden. Außerdem können 16 Prüftore definiert werden und die Reihenfolge der 
   Bits gehorcht der Reihenfolge wie die Prüftore in pfk_konvert2.cnf definiert 
   sind. 
   
   Der Standtyp wird im shm_init_&lt;ccsxxxx&gt;_...cnf festgelegt.
   Der Prueftyp ist der Typ der Pruefliste. z.B. GASU/11/12345678980 -&gt; Prueftyp=SU
   
   Die Reihenfolge der Abzuarbeitenden Pruefungen wird im Modul s_pfkconfig2 
   festgelegt. Hier ist der Prueftyp in der Reihenfolge einzutragen, in der die 
   Pruefungen erfolgen sollen.
   
   Beschreibung der Moduluebergabeparameter:</pre><b><a name="param1">1</a> PRUEFSCHRITT</b><pre>
   	GAUDI Pruefschritt
   ------------------------------</pre><b><a name="param2">2</a> POSITION</b><pre>
   	PAV- Position
   ------------------------------</pre><b><a name="param3">3</a> MODUS</b><pre>	
	      START	Wird eingetragen wenn das Modul am Anfang des Pruef-
			programmes aufgerufen wird.
			Es werden die unten beschriebenen Zaehler hochgezaehlt
			und die entsprechenden Aktionen durchgefuehrt.
	      STOP	Wird eingetragen wenn das Modul am Ende des Pruef-
			programmes aufgerufen wird.
			Es werden die unten beschriebenen Aktionen ausgefuehrt</pre><b><a name="param4">4</a> PFKBYTE_IN1</b><pre> Eingabe des aus dem SG ausgelesenen PFK-Bytes 1   (PFK-Byte)</pre><b><a name="param5">5</a> PFKBYTE_IN2</b><pre> Eingabe des aus dem SG ausgelesenen PFK-Bytes 2   (PFK-Byte)</pre><b><a name="param6">6</a> PFKBYTE_IN3</b><pre> Eingabe des aus dem SG ausgelesenen PFK-Bytes 3   (Zaehler)</pre><b><a name="param7">7</a> PFKBYTE_IN4</b><pre> Eingabe des aus dem SG ausgelesenen PFK-Bytes 4   (Zaehler)</pre><b><a name="param8">8</a> PFKBYTE_IN5</b><pre> Eingabe des aus dem SG ausgelesenen PFK-Bytes 5   (Zaehler)</pre><b><a name="param9">9</a> PFKBYTE_IN6</b><pre> Eingabe des aus dem SG ausgelesenen PFK-Bytes 6   (Zaehler)</pre><b><a name="param10">10</a> PFKBYTE_IN7</b><pre> Eingabe des aus dem SG ausgelesenen PFK-Bytes 7  (Zaehler)</pre><b><a name="param11">11</a> PFKBYTE_IN8</b><pre> Eingabe des aus dem SG ausgelesenen PFK-Bytes 8  (Zaehler)</pre><b><a name="param12">12</a> PFKBYTE_IN9</b><pre> Eingabe des aus dem SG ausgelesenen PFK-Bytes 9  (Zaehler)</pre><b><a name="param13">13</a> PFKBYTE_IN10</b><pre> Eingabe des aus dem SG ausgelesenen PFK-Bytes 10(Zaehler)
   
       Bemerkung: Das Eingabeformat ist CCS-ueblich in INT (zur Basis 10)	
    
    Modulrueckgabeparameter</pre><b><a name="param14">14</a> PFKBYTE_OUT1</b><pre> Rueckgabe des errechneten PFK-Bytes 1	(PFK-Byte)</pre><b><a name="param15">15</a> PFKBYTE_OUT2</b><pre> Rueckgabe des errechneten PFK-Bytes 2	(PFK-Byte)</pre><b><a name="param16">16</a> PFKBYTE_OUT3</b><pre> Rueckgabe des errechneten PFK-Bytes 3	(Zaehler)</pre><b><a name="param17">17</a> PFKBYTE_OUT4</b><pre> Rueckgabe des errechneten PFK-Bytes 4	(Zaehler)</pre><b><a name="param18">18</a> PFKBYTE_OUT5</b><pre> Rueckgabe des errechneten PFK-Bytes 5	(Zaehler)</pre><b><a name="param19">19</a> PFKBYTE_OUT6</b><pre> Rueckgabe des errechneten PFK-Bytes 6	(Zaehler)</pre><b><a name="param20">20</a> PFKBYTE_OUT7</b><pre> Rueckgabe des errechneten PFK-Bytes 7	(Zaehler)</pre><b><a name="param21">21</a> PFKBYTE_OUT8</b><pre> Rueckgabe des errechneten PFK-Bytes 8	(Zaehler)</pre><b><a name="param22">22</a> PFKBYTE_OUT9</b><pre> Rueckgabe des errechneten PFK-Bytes 9	(Zaehler)</pre><b><a name="param23">23</a> PFKBYTE_OUT10</b><pre> Rueckgabe des errechneten PFK-Bytes 10	(Zaehler)
  
      Bemerkung: Das Rueckgabeformat ist ein String mit den Byte als 
		 Hexwerte (z.B. F8) immer 2 Zeichen.</pre><b><a name="param24">24</a> FEHLERFLAG</b><pre>   Wird != 0 gesetzt wenn im Modul ein Fehler aufgetreten ist.</pre><b><a name="param25">25</a> ERGEBNIS</b><pre>    Rueckgabe eines Ergebnisstrings (OK- oder Fehlermelung)
   
---------------------------------------------------------------------------------
------------- Beschreibung von Byte 1 und Byte 2. -------------
Es sind also 16 Prüftypen (Prüftore) möglich. 

Die Reihenfolge der Prüftypen unten ist nur ein Beispiel von Byte 1. Die Reihenfolge ergibt sich aus 
der Reihenfolge im Konfigurationsfile pfk_konvert2.cnf fuer das jeweilige Produkt.                                                                                                                      
                                                                                                                        
PFK-Definition		Bit	7 6 5 4 3 2 1 0
ICT			IC	1 1 1 1 1 1 1 0
Flashen			PF	1 1 1 1 1 1 0 1
Funktionspruefung	AB	1 1 1 1 1 0 1 1 						      
TT		        TT      1 1 1 1 0 1 1 1
HT			HT	1 1 1 0 1 1 1 1
EP  nach IRI		EP	1 1 0 1 1 1 1 1
Reparaturplatzflag	Rp	1 0 1 1 1 1 1 1
Run-in			IR	0 1 1 1 1 1 1 1
-------- Reihenfolge der zugehörigen Prueftorzaehler. ---------------
Die Prueftorzaehler zu obigem Beispiel der PFK-Bits ist. 
Zaehler zu IC = Lownibbel von PFKBYTE_OUT3 bzw. PFKBYTE_IN3
Zaehler zu PF = Highnibble von PFKBYTE_OUT3 bzw. PFKBYTE_IN3
etc.
----------------------------------------------------------------------------------
Umsetzung  fuer ACC

siehe gesonderte Doku im Intranet. 

Beschreibung:			
PFK-Modul			
Das PFK-Modul verwaltet die fuer SG2000  definierten 5 PFK-Bytes . Im ersten Byte sind in den einzelnen Bits die durchlaufenen			
Prueftore abgebildet. Die folgenden 4 Bytes sind jeweils unterteilt in insgesamt 8 Halbbytes. In diesen Halbbytes werden Zähler 			
dargestellt (s. o.).  Je nach Betriebszustand  werden beim Durchlaufen des Moduls ein Bit im PFK-Byte und  1 Zahler geändert. 			
Das Modul enthält ausschließlich die Aufbereitung der PFK-Bytes. Die Kommunikation  ( PFK lesen und schreiben) ist 
prueflingsindividuell und wird vor und nach dem Modul mit bestehenden Kommunikationsmodulen realisiert.

Konfigurationsmodul
Im Konfigurationsmodul werden die Prueftore, die das Erzeugnis zu durchlaufen hat definiert und den PFK-Bits zugeordnet.

Stichproben:
        Es wird von einer Stichprobenprüfung ausgegangen, wenn Standtyp != Prueftyp ist. Dann wird der
        Prueftorzaehler incrementiert. Es wird allerdings nicht die Vorgeschichte überprüft.
        Die Stichproben, die vorkommen koennen muessen im s_pfkconfig eingetragen sein.

Implementierung im Pruefprogramm:
das Konfigurationsmodul und das PFK-Modul im Modus "Start"  wird in der Pruefliste mit der
erforderlichen Kommunikation am Listen-Anfang aufgerufen.
Am Ende der Pruefliste wird das PFK-Modul  mit den notwendigen Kommunikationsmodulen im Modus Stop aufgerufen
Um keine Informationen zu verlieren, ist sowohl  bei "Start" als auch bei "Stop" ein Beschreiben des EEProms mit
PFK-Informationen angebracht
 
</PRE>
</BODY>
</HTML>
